{"version":3,"sources":["super-res.min.js","/source/super-res.js","/source/src/utils.js","/source/src/request.js","/source/src/ResourceAction.js","/source/src/super-res.js"],"names":["_classCallCheck","instance","Constructor","TypeError","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","protoProps","staticProps","prototype","global","factory","exports","module","require","define","amd","superRes","Q","Route","cacheManager","sa","methods","this","assignOptions","result","_len","arguments","opts","Array","_key","reduce","opt","isArray","concat","utils_js__assign","undefined","request","method","url","options","defaultOpts","curReq","accept","responseType","headers","set","timeout","clearTimeout","withCredentials","originalEnd","end","fn","_data","transformRequest","memo","transform","call","header","e","catchRequestError","promise","catchFunc","Promise","resolve","reject","then","err","res","body","transformResponse","spread","catchResponseError","moveDataToParam","data","query","getCacheKey","params","JSON","stringify","generateDefaultActions","defaultParams","commonOptions","resource","action","ResourceAction","super_res__assign","get","makeRequest","bind","save","put","remove","cache","forEach","name","toUpperCase","value","req","send","ResourceAction_js__assign","actionDefaults","config","push","hasData","route","extraParams","param","slice","caching","store","max","ttl","toLowerCase","reverse","match","empty","currentRequest","_this","deferred","defer","extraP","p","fullParams","doRequest","buildRequest","super_res__superRes","actions","getOwnPropertyNames","apply","promiseWrapper","wrapperFunc","proxiedResource","actionFunction","_len2","args","_key2","super_res"],"mappings":"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","file":"super-res.min.js","sourcesContent":[null,"(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory(require('q'), require('route-parser'), require('cache-manager'), require('superagent'), require('methods')) :\n  typeof define === 'function' && define.amd ? define(['q', 'route-parser', 'cache-manager', 'superagent', 'methods'], factory) :\n  global.superRes = factory(global.Q, global.Route, global.cacheManager, global.sa, global.methods)\n}(this, function (Q, Route, cacheManager, sa, methods) { 'use strict';\n\n  var utils_js__assign = utils_js__assign || require('object.assign');\n\n  function assignOptions(...opts) {\n    let result = {};\n\n    opts.reduce((result, opt)=> {\n      if(opt) {\n        for(let i in opt) {\n          if(typeof opt[i] === 'object' && opt[i] !== null) {\n            if(Array.isArray(opt[i])) {\n              if(!Array.isArray(result[i])) {\n                result[i] = [];\n              }\n              result[i] = result[i].concat(opt[i]);\n\n            } else {\n              if(typeof result[i] !== 'object' || result[i] === null || Array.isArray(result[i])) {\n                result[i] = {};\n              }\n              utils_js__assign(result[i], opt[i]); //1 depth merging only.\n            }\n          } else {\n            opt[i] !== undefined && (result[i] = opt[i]);\n          }\n        }\n      }\n      return result;\n    }, result);\n\n    return result;\n  }\n\n  const defaultOpts = {\n    responseType: 'json',\n    transformRequest: [],\n    catchRequestError: [],\n    transformResponse: [],\n    catchResponseError: [],\n    withCredentials: false,\n    cache: null\n  };\n\n  function request (method, url, options) {\n    options = assignOptions(defaultOpts, options);\n\n    let curReq = sa(method, url);\n    curReq.accept(options.responseType);\n    if (options.headers) {\n      curReq.set(options.headers);\n    }\n\n    if (options.timeout) {\n      curReq.timeout(options.timeout);\n    } else {\n      curReq.clearTimeout();\n    }\n\n    if (options.withCredentials) {\n      curReq.withCredentials();\n    }\n\n    let originalEnd = curReq.end;\n    curReq.end = function (fn) {\n      if (curReq._data && typeof curReq._data === 'object') {\n        try {\n          curReq._data = options.transformRequest.reduce(\n            (memo, transform) => transform.call(curReq, memo, curReq.header),\n            curReq._data\n          );\n        } catch(e) {\n          options.catchRequestError.reduce(\n            (promise, catchFunc) => promise.catch(catchFunc),\n            Q.Promise((resolve, reject) => reject(e))\n          )\n          .then(fn, fn);\n          return this;\n        }\n      }\n      return originalEnd.call(curReq, (err, res)=>{\n        if (err) {\n          options.catchResponseError.reduce(\n            (promise, catchFunc) => promise.catch(catchFunc),\n            Q.Promise((resolve, reject) => reject(err))\n          )\n          .then(fn, fn);\n        } else {\n          try {\n            res.body = options.transformResponse.reduce(\n              (memo, transform) => transform.call(res, memo),\n              res.body\n            );\n          } catch(e) {\n            return Q(e).then(fn);\n          }\n          return Q.spread([null, res], fn);\n        }\n      });\n    };\n\n    return curReq;\n  }\n\n  methods.forEach(function(method){\n    var name = 'delete' == method ? 'del' : method;\n    method = method.toUpperCase();\n    Object.defineProperty(request, name, {\n      value: function(url, data, fn, options){\n        if ('function' === typeof data) {\n          options = fn;\n          fn = data;\n          data = null;\n        }\n        var req = request(method, url, options);\n        if (data) {\n          req.send(data);\n        }\n        fn && req.end(fn);\n        return req;\n      },\n      enumerable: true\n    });\n  });\n\n  Object.defineProperty(request, 'config', {\n    value: defaultOpts\n  });\n\n  var ResourceAction_js__assign = ResourceAction_js__assign || require('object.assign');\n\n  const actionDefaults = {\n    method: 'GET',\n    transformRequest: [],\n    cache: null\n  };\n\n  function moveDataToParam(data, header) {\n    data && this.query(data);\n    return null\n  }\n\n  function getCacheKey(params, data) {\n    return JSON.stringify(params || {}) + JSON.stringify(data || {});\n  }\n\n  class ResourceAction {\n    constructor(url, defaultParams, action) {\n      this.config = assignOptions({url: url}, actionDefaults, action);\n\n      if(this.config.method === 'GET') {\n        this.config.transformRequest || (this.config.transformRequest = []);\n        this.config.transformRequest.push(moveDataToParam);\n      } else if((this.config.method === 'POST' ||\n        this.config.method === 'PUT' ||\n        this.config.method === 'PATCH')) {\n        this.hasData = true;\n      }\n\n      this.route = new Route(this.config.url);\n      this.defaultParams = defaultParams;\n\n      this.extraParams = {};\n      for(let i in defaultParams) {\n        let param = defaultParams[i];\n        if(typeof param === 'function') {\n          this.extraParams[i] = param;\n        } else if(typeof param === 'string' && param[0] === '@') {\n          this.extraParams[i] = param.slice(1);\n        } else {\n          continue;\n        }\n        delete this.defaultParams[i];\n      }\n\n      if (this.config.cache === true) {\n        this.config.cache = cacheManager.caching({store: 'memory', max: 100, ttl: 1200});\n      }\n    }\n\n    buildRequest(params, data) {\n      let method = this.config.method.toLowerCase();\n      let url = this.route.reverse(params);\n\n      for(let i in this.route.match(url)) {\n        delete params[i];\n      }\n      let empty = true;\n      if(params) {\n        for(let i in params) {\n          empty = false;\n          break;\n        }\n      }\n\n      let currentRequest = request[method === 'delete' ? 'del' : method](url, null, null, this.config);\n\n      if(!empty) {\n        currentRequest.query(params);\n      }\n\n      if (data) {\n        currentRequest.send(data);\n      }\n\n      return currentRequest;\n    }\n    makeRequest(params, data) {\n      let deferred = Q.defer();\n\n      if(arguments.length == 1 && this.hasData) {\n        data = params;\n        params = undefined;\n      }\n\n      let extraP = {};\n      for(let i in this.extraParams) {\n        let p = this.extraParams[i], result;\n        if(typeof p === 'function') {\n          result = p();\n        } else {\n          result = data[p];\n        }\n        result && (extraP[i] = result);\n      }\n\n      let fullParams = ResourceAction_js__assign({}, this.defaultParams, extraP, params);\n\n      let doRequest = () => {\n        this.buildRequest(fullParams, data)\n            .end((err, res) => {\n              if (err) {\n                deferred.reject(err);\n              } else {\n\n                if (this.config.cache) {\n                  this.config.cache.set(getCacheKey(fullParams, data), res.body);\n                }\n\n                deferred.resolve(res.body);\n              }\n            });\n      };\n\n      if (this.config.cache && this.config.method.toLowerCase() === 'get') {\n        let key = getCacheKey(fullParams, data);\n        this.config.cache.get(key, (err, result) => {\n          if (err) {\n            deferred.reject(err);\n          } else if (result) {\n            deferred.resolve(result);\n          } else {\n            doRequest();\n          }\n        })\n      } else {\n        doRequest();\n      }\n\n      return deferred.promise;\n    }\n  }\n\n  var super_res__assign = super_res__assign || require('object.assign');\n\n  let super_res__superRes = {};\n\n  function generateDefaultActions(url, defaultParams, commonOptions) {\n    let resource = {};\n\n    let action = new ResourceAction(url, defaultParams, super_res__assign({}, commonOptions));\n    resource.get = action.makeRequest.bind(action);\n    resource.query = resource.get;\n\n    action = new ResourceAction(url, defaultParams, super_res__assign({}, commonOptions, {method: 'POST'}));\n    resource.save = action.makeRequest.bind(action);\n\n    action = new ResourceAction(url, defaultParams, super_res__assign({}, commonOptions, {method: 'PUT'}));\n    resource.put = action.makeRequest.bind(action);\n\n    action = new ResourceAction(url, defaultParams, super_res__assign({}, commonOptions, {method: 'DELETE'}));\n    resource.remove = action.makeRequest.bind(action);\n    resource['delete'] = resource.remove;\n\n    return resource;\n  }\n\n  super_res__superRes.resource = (url, defaultParams, actions, commonOptions) => {\n    let resource = generateDefaultActions(url, defaultParams, commonOptions);\n    if (actions) {\n      Object.getOwnPropertyNames(actions).forEach((name) => {\n        let action = new ResourceAction(url, defaultParams, actions[name]);\n        resource[name] = function (...args) {\n          action.makeRequest(...args);\n        }\n      });\n    }\n    return resource;\n  };\n\n  super_res__superRes.request = request;\n  super_res__superRes.config = request.config;\n\n  super_res__superRes.promiseWrapper = function promiseWrapper(wrapperFunc) {\n    return (resource) => {\n      let proxiedResource = super_res__assign({}, resource);\n      Object.getOwnPropertyNames(resource).forEach((name) => {\n        let actionFunction = proxiedResource[name];\n        proxiedResource[name] = function (...args) {\n          let promise = actionFunction.apply(proxiedResource, args);\n          return wrapperFunc(promise);\n        }\n      });\n      return proxiedResource;\n    }\n  };\n\n  var super_res = super_res__superRes;\n\n  return super_res;\n\n}));\n","var assign = assign || require('object.assign');\n\nexport function assignOptions(...opts) {\n  let result = {};\n\n  opts.reduce((result, opt)=> {\n    if(opt) {\n      for(let i in opt) {\n        if(typeof opt[i] === 'object' && opt[i] !== null) {\n          if(Array.isArray(opt[i])) {\n            if(!Array.isArray(result[i])) {\n              result[i] = [];\n            }\n            result[i] = result[i].concat(opt[i]);\n\n          } else {\n            if(typeof result[i] !== 'object' || result[i] === null || Array.isArray(result[i])) {\n              result[i] = {};\n            }\n            assign(result[i], opt[i]); //1 depth merging only.\n          }\n        } else {\n          opt[i] !== undefined && (result[i] = opt[i]);\n        }\n      }\n    }\n    return result;\n  }, result);\n\n  return result;\n}","import Q from 'q';\nimport sa from 'superagent';\nimport methods from 'methods';\nimport {assignOptions} from './utils.js';\n\nconst defaultOpts = {\n  responseType: 'json',\n  transformRequest: [],\n  catchRequestError: [],\n  transformResponse: [],\n  catchResponseError: [],\n  withCredentials: false,\n  cache: null\n};\n\nfunction request (method, url, options) {\n  options = assignOptions(defaultOpts, options);\n\n  let curReq = sa(method, url);\n  curReq.accept(options.responseType);\n  if (options.headers) {\n    curReq.set(options.headers);\n  }\n\n  if (options.timeout) {\n    curReq.timeout(options.timeout);\n  } else {\n    curReq.clearTimeout();\n  }\n\n  if (options.withCredentials) {\n    curReq.withCredentials();\n  }\n\n  let originalEnd = curReq.end;\n  curReq.end = function (fn) {\n    if (curReq._data && typeof curReq._data === 'object') {\n      try {\n        curReq._data = options.transformRequest.reduce(\n          (memo, transform) => transform.call(curReq, memo, curReq.header),\n          curReq._data\n        );\n      } catch(e) {\n        options.catchRequestError.reduce(\n          (promise, catchFunc) => promise.catch(catchFunc),\n          Q.Promise((resolve, reject) => reject(e))\n        )\n        .then(fn, fn);\n        return this;\n      }\n    }\n    return originalEnd.call(curReq, (err, res)=>{\n      if (err) {\n        options.catchResponseError.reduce(\n          (promise, catchFunc) => promise.catch(catchFunc),\n          Q.Promise((resolve, reject) => reject(err))\n        )\n        .then(fn, fn);\n      } else {\n        try {\n          res.body = options.transformResponse.reduce(\n            (memo, transform) => transform.call(res, memo),\n            res.body\n          );\n        } catch(e) {\n          return Q(e).then(fn);\n        }\n        return Q.spread([null, res], fn);\n      }\n    });\n  };\n\n  return curReq;\n}\n\nmethods.forEach(function(method){\n  var name = 'delete' == method ? 'del' : method;\n  method = method.toUpperCase();\n  Object.defineProperty(request, name, {\n    value: function(url, data, fn, options){\n      if ('function' === typeof data) {\n        options = fn;\n        fn = data;\n        data = null;\n      }\n      var req = request(method, url, options);\n      if (data) {\n        req.send(data);\n      }\n      fn && req.end(fn);\n      return req;\n    },\n    enumerable: true\n  });\n});\n\nObject.defineProperty(request, 'config', {\n  value: defaultOpts\n});\n\nexport default request;","var assign = assign || require('object.assign');\n\nimport Q from 'q';\nimport Route from 'route-parser';\nimport cacheManager from 'cache-manager';\n\nimport request from './request.js';\nimport {assignOptions} from './utils.js'\n\nconst actionDefaults = {\n  method: 'GET',\n  transformRequest: [],\n  cache: null\n};\n\nfunction moveDataToParam(data, header) {\n  data && this.query(data);\n  return null\n}\n\nfunction getCacheKey(params, data) {\n  return JSON.stringify(params || {}) + JSON.stringify(data || {});\n}\n\nexport default class ResourceAction {\n  constructor(url, defaultParams, action) {\n    this.config = assignOptions({url: url}, actionDefaults, action);\n\n    if(this.config.method === 'GET') {\n      this.config.transformRequest || (this.config.transformRequest = []);\n      this.config.transformRequest.push(moveDataToParam);\n    } else if((this.config.method === 'POST' ||\n      this.config.method === 'PUT' ||\n      this.config.method === 'PATCH')) {\n      this.hasData = true;\n    }\n\n    this.route = new Route(this.config.url);\n    this.defaultParams = defaultParams;\n\n    this.extraParams = {};\n    for(let i in defaultParams) {\n      let param = defaultParams[i];\n      if(typeof param === 'function') {\n        this.extraParams[i] = param;\n      } else if(typeof param === 'string' && param[0] === '@') {\n        this.extraParams[i] = param.slice(1);\n      } else {\n        continue;\n      }\n      delete this.defaultParams[i];\n    }\n\n    if (this.config.cache === true) {\n      this.config.cache = cacheManager.caching({store: 'memory', max: 100, ttl: 1200});\n    }\n  }\n\n  buildRequest(params, data) {\n    let method = this.config.method.toLowerCase();\n    let url = this.route.reverse(params);\n\n    for(let i in this.route.match(url)) {\n      delete params[i];\n    }\n    let empty = true;\n    if(params) {\n      for(let i in params) {\n        empty = false;\n        break;\n      }\n    }\n\n    let currentRequest = request[method === 'delete' ? 'del' : method](url, null, null, this.config);\n\n    if(!empty) {\n      currentRequest.query(params);\n    }\n\n    if (data) {\n      currentRequest.send(data);\n    }\n\n    return currentRequest;\n  }\n  makeRequest(params, data) {\n    let deferred = Q.defer();\n\n    if(arguments.length == 1 && this.hasData) {\n      data = params;\n      params = undefined;\n    }\n\n    let extraP = {};\n    for(let i in this.extraParams) {\n      let p = this.extraParams[i], result;\n      if(typeof p === 'function') {\n        result = p();\n      } else {\n        result = data[p];\n      }\n      result && (extraP[i] = result);\n    }\n\n    let fullParams = assign({}, this.defaultParams, extraP, params);\n\n    let doRequest = () => {\n      this.buildRequest(fullParams, data)\n          .end((err, res) => {\n            if (err) {\n              deferred.reject(err);\n            } else {\n\n              if (this.config.cache) {\n                this.config.cache.set(getCacheKey(fullParams, data), res.body);\n              }\n\n              deferred.resolve(res.body);\n            }\n          });\n    };\n\n    if (this.config.cache && this.config.method.toLowerCase() === 'get') {\n      let key = getCacheKey(fullParams, data);\n      this.config.cache.get(key, (err, result) => {\n        if (err) {\n          deferred.reject(err);\n        } else if (result) {\n          deferred.resolve(result);\n        } else {\n          doRequest();\n        }\n      })\n    } else {\n      doRequest();\n    }\n\n    return deferred.promise;\n  }\n}","var assign = assign || require('object.assign');\n\nimport Q from 'q';\n\nimport ResourceAction from './ResourceAction.js';\nimport request from './request.js'\n\nlet superRes = {};\n\nfunction generateDefaultActions(url, defaultParams, commonOptions) {\n  let resource = {};\n\n  let action = new ResourceAction(url, defaultParams, assign({}, commonOptions));\n  resource.get = action.makeRequest.bind(action);\n  resource.query = resource.get;\n\n  action = new ResourceAction(url, defaultParams, assign({}, commonOptions, {method: 'POST'}));\n  resource.save = action.makeRequest.bind(action);\n\n  action = new ResourceAction(url, defaultParams, assign({}, commonOptions, {method: 'PUT'}));\n  resource.put = action.makeRequest.bind(action);\n\n  action = new ResourceAction(url, defaultParams, assign({}, commonOptions, {method: 'DELETE'}));\n  resource.remove = action.makeRequest.bind(action);\n  resource['delete'] = resource.remove;\n\n  return resource;\n}\n\nsuperRes.resource = (url, defaultParams, actions, commonOptions) => {\n  let resource = generateDefaultActions(url, defaultParams, commonOptions);\n  if (actions) {\n    Object.getOwnPropertyNames(actions).forEach((name) => {\n      let action = new ResourceAction(url, defaultParams, actions[name]);\n      resource[name] = function (...args) {\n        action.makeRequest(...args);\n      }\n    });\n  }\n  return resource;\n};\n\nsuperRes.request = request;\nsuperRes.config = request.config;\n\nsuperRes.promiseWrapper = function promiseWrapper(wrapperFunc) {\n  return (resource) => {\n    let proxiedResource = assign({}, resource);\n    Object.getOwnPropertyNames(resource).forEach((name) => {\n      let actionFunction = proxiedResource[name];\n      proxiedResource[name] = function (...args) {\n        let promise = actionFunction.apply(proxiedResource, args);\n        return wrapperFunc(promise);\n      }\n    });\n    return proxiedResource;\n  }\n};\n\nexport default superRes;\n"],"sourceRoot":"/source/"}