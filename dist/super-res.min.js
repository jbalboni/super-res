function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r(require("q"),require("route-parser"),require("superagent"),require("methods"),require("cache-manager")):"function"==typeof define&&define.amd?define(["q","route-parser","superagent","methods","cache-manager"],r):e.superRes=r(e.Q,e.Route,e.sa,e.methods,e.cacheManager)}(this,function(e,r,t,n,a){"use strict";function o(){for(var e={},r=arguments.length,t=Array(r),n=0;r>n;n++)t[n]=arguments[n];return t.reduce(function(e,r){if(r)for(var t in r)"object"==typeof r[t]&&null!==r[t]?Array.isArray(r[t])?(Array.isArray(e[t])||(e[t]=[]),e[t]=e[t].concat(r[t])):(("object"!=typeof e[t]||null===e[t]||Array.isArray(e[t]))&&(e[t]={}),f(e[t],r[t])):void 0!==r[t]&&(e[t]=r[t]);return e},e),e}function i(e,r,t){return e+"_"+("string"==typeof r?r:JSON.stringify(r||{}))+"_"+("string"==typeof t?t:JSON.stringify(t||{}))}function s(r,n,a){a=o(h,a);var s=t(r,n);s.accept(a.responseType),a.headers&&s.set(a.headers),a.timeout?s.timeout(a.timeout):s.clearTimeout(),a.withCredentials&&s.withCredentials(),1==a.cache&&(a.cache=l);var u=s.end;return s.end=function(r){var t=this,n=void 0;a.cache&&(n=i(this.url,this._query,this._data));var o=function(){if(s._data&&"object"==typeof s._data)try{s._data=a.transformRequest.reduce(function(e,r){return r.call(s,e,s.header)},s._data)}catch(o){return a.catchRequestError.reduce(function(e,r){return e["catch"](r)},e.Promise(function(e,r){return r(o)})).then(r,r),t}return u.call(s,function(t,o){if(t)a.catchResponseError.reduce(function(e,r){return e["catch"](r)},e.Promise(function(e,r){return r(t)})).then(r,r);else{try{o.body=a.transformResponse.reduce(function(e,r){return r.call(o,e)},o.body),a.cache&&a.cache.set(n,o)}catch(i){return e(i).then(r)}e.spread([null,o],r)}})};return a.cache&&"GET"===this.method?void a.cache.get(n,function(n,a){return n||a?(e.spread([n,a],r),t):o()}):o()},s}function u(e,r){return e&&this.query(e),null}function c(e,r,t){var n={},a=new p(e,r,v({},t));return n.get=a.makeRequest.bind(a),n.query=n.get,a=new p(e,r,v({},t,{method:"POST"})),n.save=a.makeRequest.bind(a),a=new p(e,r,v({},t,{method:"PUT"})),n.put=a.makeRequest.bind(a),a=new p(e,r,v({},t,{method:"DELETE"})),n.remove=a.makeRequest.bind(a),n["delete"]=n.remove,n}var f=f||require("object.assign"),h={responseType:"json",transformRequest:[],catchRequestError:[],transformResponse:[],catchResponseError:[],withCredentials:!1,cache:null},l=a.caching({store:"memory",max:100,ttl:1200});n.forEach(function(e){var r="delete"==e?"del":e;e=e.toUpperCase(),Object.defineProperty(s,r,{value:function(r,t,n,a){"function"==typeof t&&(a=n,n=t,t=null);var o=s(e,r,a);return t&&o.send(t),n&&o.end(n),o},enumerable:!0})}),Object.defineProperty(s,"config",{value:h});var d=d||require("object.assign"),m={method:"GET",transformRequest:[]},p=function(){function t(e,n,a){_classCallCheck(this,t),this.config=o({url:e},m,a),"GET"===this.config.method?(this.config.transformRequest||(this.config.transformRequest=[]),this.config.transformRequest.push(u)):("POST"===this.config.method||"PUT"===this.config.method||"PATCH"===this.config.method)&&(this.hasData=!0),this.route=new r(this.config.url),this.defaultParams=n,this.extraParams={};for(var i in n){var s=n[i];if("function"==typeof s)this.extraParams[i]=s;else{if("string"!=typeof s||"@"!==s[0])continue;this.extraParams[i]=s.slice(1)}delete this.defaultParams[i]}}return _createClass(t,[{key:"buildRequest",value:function(e,r){var t=this.config.method.toLowerCase(),n=this.route.reverse(e);for(var a in this.route.match(n))delete e[a];var o=!0;if(e)for(var a in e){o=!1;break}var i=s["delete"===t?"del":t](n,null,null,this.config);return o||i.query(e),r&&i.send(r),i}},{key:"makeRequest",value:function(r,t){var n=e.defer();1==arguments.length&&this.hasData&&(t=r,r=void 0);var a={};for(var o in this.extraParams){var i=this.extraParams[o],s=void 0;s="function"==typeof i?i():t[i],s&&(a[o]=s)}var u=d({},this.defaultParams,a,r);return this.buildRequest(u,t).end(function(e,r){e?n.reject(e):n.resolve(r.body)}),n.promise}}]),t}(),v=v||require("object.assign"),y={};y.resource=function(e,r,t,n){var a=c(e,r,n);return t&&Object.getOwnPropertyNames(t).forEach(function(o){var i=new p(e,r,v({},n,t[o]));a[o]=function(){i.makeRequest.apply(i,arguments)}}),a},y.request=s,y.config=s.config,y.promiseWrapper=function(e){return function(r){var t=v({},r);return Object.getOwnPropertyNames(r).forEach(function(r){var n=t[r];t[r]=function(){for(var r=arguments.length,a=Array(r),o=0;r>o;o++)a[o]=arguments[o];var i=n.apply(t,a);return e(i)}}),t}};var g=y;return g});
//# sourceMappingURL=super-res.min.js.map